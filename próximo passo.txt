name: Testes de Integração com Chatbot

on:
push:
branches:
- main
pull_request:
branches:
- main

jobs:
test:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2

  - name: Configurar Python
    uses: actions/setup-python@v2
    with:
      python-version: '3.x'

  - name: Instalar dependências
    run: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt

  - name: Testar a lógica do chatbot
    run: |
      python -c "from app import chatbot_resposta; print(chatbot_resposta('olá'))"

  - name: Verificar o servidor Flask
    run: |
      pip install requests
      python -c "import requests; import json; r = requests.post('http://localhost:5000/get_response', json={'message': 'tudo bem'}); r.raise_for_status(); print(r.json())"
    
  - name: Iniciar o servidor Flask em segundo plano
    run: python app.py &
